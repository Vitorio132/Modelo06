<!DOCTYPE html>
<html>

<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Sistema de Presença - Professores</title>

  <style>
    body {
      background-color: #fff176;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      margin: 0;
      font-family: Arial, sans-serif;
    }
    #loginDiv, #mainDiv {
      background: white;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 8px 16px rgba(0,0,0,0.3);
      text-align: center;
      position: relative;
    }
    .logoImg {
      position: absolute;
      top: 10px;
      right: 10px;
      width: 120px;
    }
    input, select, button {
      width: 80%;
      margin: 8px 0;
      padding: 10px;
      border-radius: 6px;
      border: 1px solid #ccc;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: center;
    }
    #btnRemoverAluno {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background-color: #e53935;
      color: white;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      font-size: 18px;
      border: none;
      cursor: pointer;
      box-shadow: 0 4px 8px rgba(0,0,0,0.3);
      display: none;
    }
    #modalRemover .logoImg {
      position: absolute;
      top: 10px;
      right: 10px;
      width: 100px;
    }
  </style>

  
</head>
<body>
  <div id="loginDiv">
  <img src="28874d9d-623f-439e-8fa8-df2b62871b6c.png" class="logoImg" alt="Logo IACAS">
  <h2>Login do Professor</h2>
  <input type="text" id="loginUsuario" placeholder="Usuário"><br>
  <input type="password" id="loginSenha" placeholder="Senha"><br>
  <button onclick="fazerLogin()">Entrar</button>
</div>

<div id="mainDiv" style="display:none;">
  <img src="28874d9d-623f-439e-8fa8-df2b62871b6c.png" class="logoImg" alt="Logo IACAS">
  <h2>Sistema de Presença</h2>

  <label>Escola:</label>
  <select id="escolaSelect" onchange="selecionarEscola()">
    <option value="">Selecione a escola</option>
  </select><br>

  <div id="turmaDiv" style="display:none;">
    <label>Turma:</label>
    <select id="turmaSelect" onchange="carregarAlunos()">
      <option value="">Selecione a turma</option>
    </select><br>
  </div>

  <div id="adicionarAlunoDiv" style="display:none;">
    <input type="text" id="alunoNome" placeholder="Nome do aluno">
    <button onclick="adicionarAluno()">Adicionar Aluno</button>
  </div>

  <div id="alunosDiv"></div>

  <button onclick="exportarExcel()">Exportar para Excel</button>
  <button onclick="voltarSelecao()">Voltar para Seleção de Escolas</button>
</div>

<button id="btnRemoverAluno" title="Remover aluno" onclick="abrirModalRemover()">−</button>

<div id="modalRemover" style="display:none; position:fixed; left:0; top:0; width:100%; height:100%; background-color: rgba(0,0,0,0.5);">
  <div style="background:white; max-width:400px; margin:100px auto; padding:20px; border-radius:8px; position:relative;">
    <img src="28874d9d-623f-439e-8fa8-df2b62871b6c.png" class="logoImg" alt="Logo IACAS">
    <h3>Remover aluno</h3>
    <div id="listaRemover"></div>
    <button onclick="fecharModalRemover()">Fechar</button>
  </div>
</div>

  <script>
    const usuarios = [
  { usuario: "prof1", senha: "123" }, { usuario: "prof2", senha: "123" },
  { usuario: "prof3", senha: "123" }, { usuario: "prof4", senha: "123" },
  { usuario: "prof5", senha: "123" }, { usuario: "prof6", senha: "123" },
  { usuario: "prof7", senha: "123" }, { usuario: "prof8", senha: "123" },
  { usuario: "prof9", senha: "123" }, { usuario: "prof10", senha: "123" },
];

const escolas = {
  "CMEI Padre Luís Ruas": ["Turma 1"],
  "Escola Municipal Nova Vida": ["Turma 1"],
  "Escola Municipal Liberalina Weill": ["Turma 1", "Turma 2"],
  "Escola Estadual Santo Antônio": ["Turma 1", "Turma 2"],
  "Adolescentes - Vila da Felicidade - Matutino": ["Turma 1"],
  "Adolescentes - Vila da Felicidade - Vespertino": ["Turma 2"],
  "Crianças - Vila da Felicidade": ["Turma 3", "Turma 4", "Vespertino"]
};

let escolaAtual = "";
let turmaAtual = "";
let presencas = {};

window.onload = () => carregarDoLocalStorage();

function fazerLogin() {
  const u = document.getElementById("loginUsuario").value;
  const s = document.getElementById("loginSenha").value;
  const user = usuarios.find(x => x.usuario === u && x.senha === s);
  if (user) {
    document.getElementById("loginDiv").style.display = "none";
    document.getElementById("mainDiv").style.display = "block";
    carregarEscolas();
  } else {
    alert("Login inválido!");
  }
}

function carregarEscolas() {
  const escolaSelect = document.getElementById("escolaSelect");
  escolaSelect.innerHTML = '<option value="">Selecione a escola</option>';
  Object.keys(escolas).forEach(e => {
    escolaSelect.innerHTML += `<option value="${e}">${e}</option>`;
  });
}

function selecionarEscola() {
  escolaAtual = document.getElementById("escolaSelect").value;
  if (!escolaAtual) return;
  document.getElementById("escolaSelect").disabled = true;
  document.getElementById("turmaDiv").style.display = "block";
  carregarTurmas();
}

function carregarTurmas() {
  const turmaSelect = document.getElementById("turmaSelect");
  turmaSelect.innerHTML = '<option value="">Selecione a turma</option>';
  escolas[escolaAtual].forEach(t => {
    turmaSelect.innerHTML += `<option value="${t}">${t}</option>`;
  });
}

function carregarAlunos() {
  turmaAtual = document.getElementById("turmaSelect").value;
  const removerBtn = document.getElementById("btnRemoverAluno");

  if (!turmaAtual) {
    document.getElementById("adicionarAlunoDiv").style.display = "none";
    removerBtn.style.display = "none";
    return;
  }

  document.getElementById("adicionarAlunoDiv").style.display = "block";
  removerBtn.style.display = "block";

  const chave = escolaAtual + "_" + turmaAtual;
  if (!presencas[chave]) presencas[chave] = [];
  mostrarLista();
}

function mostrarLista() {
  const div = document.getElementById("alunosDiv");
  div.innerHTML = "";
  const chave = escolaAtual + "_" + turmaAtual;
  if (!presencas[chave]) return;

  let tabela = "<table><tr><th>Nome</th><th>Presente</th><th>Falta</th><th>Justificado</th></tr>";
  presencas[chave].forEach((aluno, index) => {
    tabela += `<tr>
      <td>${aluno.nome}</td>
      <td><input type="checkbox" ${aluno.presente ? 'checked' : ''} onchange="togglePresenca(${index}, 'presente')"></td>
      <td><input type="checkbox" ${aluno.falta ? 'checked' : ''} onchange="togglePresenca(${index}, 'falta')"></td>
      <td><input type="checkbox" ${aluno.justificado ? 'checked' : ''} onchange="togglePresenca(${index}, 'justificado')"></td>
    </tr>`;
  });
  tabela += "</table>";
  div.innerHTML = tabela;
}

function togglePresenca(index, tipo) {
  const chave = escolaAtual + "_" + turmaAtual;
  const aluno = presencas[chave][index];
  aluno.presente = (tipo === 'presente');
  aluno.falta = (tipo === 'falta');
  aluno.justificado = (tipo === 'justificado');
  salvarNoLocalStorage();
  mostrarLista();
}

function adicionarAluno() {
  if (!escolaAtual || !turmaAtual) return alert("Selecione escola e turma antes de adicionar alunos!");

  const nome = document.getElementById("alunoNome").value.trim();
  if (!nome) return alert("Digite o nome do aluno!");

  const chave = escolaAtual + "_" + turmaAtual;
  if (presencas[chave].some(a => a.nome.toLowerCase() === nome.toLowerCase()))
    return alert("Aluno já existe!");

  presencas[chave].push({ nome, presente: false, falta: false, justificado: false });
  salvarNoLocalStorage();
  document.getElementById("alunoNome").value = "";
  mostrarLista();
}

function abrirModalRemover() {
  const chave = escolaAtual + "_" + turmaAtual;
  const listaDiv = document.getElementById("listaRemover");
  listaDiv.innerHTML = "";

  presencas[chave].forEach((aluno, i) => {
    const div = document.createElement("div");
    div.style.marginBottom = "8px";
    const span = document.createElement("span");
    span.textContent = aluno.nome;
    const btn = document.createElement("button");
    btn.textContent = "Remover";
    btn.onclick = () => {
      if (confirm(`Remover o aluno ${aluno.nome}?`)) {
        presencas[chave].splice(i, 1);
        salvarNoLocalStorage();
        mostrarLista();
        abrirModalRemover();
      }
    };
    div.appendChild(span);
    div.appendChild(btn);
    listaDiv.appendChild(div);
  });

  document.getElementById("modalRemover").style.display = "block";
}

function fecharModalRemover() {
  document.getElementById("modalRemover").style.display = "none";
}

function exportarExcel() {
  const chave = escolaAtual + "_" + turmaAtual;
  const dados = [["Nome", "Presente", "Falta", "Justificado"]];
  presencas[chave].forEach(aluno => {
    dados.push([
      aluno.nome,
      aluno.presente ? "Sim" : "Não",
      aluno.falta ? "Sim" : "Não",
      aluno.justificado ? "Sim" : "Não"
    ]);
  });
  const ws = XLSX.utils.aoa_to_sheet(dados);
  const wb = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb, ws, turmaAtual);
  XLSX.writeFile(wb, escolaAtual + " - " + turmaAtual + ".xlsx");
}

function voltarSelecao() {
  document.getElementById("escolaSelect").value = "";
  document.getElementById("escolaSelect").disabled = false;
  document.getElementById("turmaDiv").style.display = "none";
  document.getElementById("adicionarAlunoDiv").style.display = "none";
  document.getElementById("btnRemoverAluno").style.display = "none";
  document.getElementById("turmaSelect").innerHTML = '<option value="">Selecione a turma</option>';
  escolaAtual = "";
  turmaAtual = "";
  document.getElementById("alunosDiv").innerHTML = "";
  document.getElementById("alunoNome").value = "";
}

function salvarNoLocalStorage() {
  localStorage.setItem("presencasGlobal", JSON.stringify(presencas));
}

function carregarDoLocalStorage() {
  const dados = localStorage.getItem("presencasGlobal");
  if (dados) presencas = JSON.parse(dados);
}
  </script>
</body>
</html>
