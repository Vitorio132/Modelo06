<!DOCTYPE html>
<html>

<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Sistema de Presença - IACAS</title>

  <style>
    body {
        background: linear-gradient(120deg, #f0f4f8, #d9e2ec);
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        margin: 0;
        padding: 0;
    }

    .container {
        max-width: 700px;
        margin: 50px auto;
        background: #ffffff;
        padding: 30px;
        border-radius: 15px;
        box-shadow: 0 8px 16px rgba(0,0,0,0.1);
    }

    h2 {
        text-align: center;
        color: #333;
    }

    input, select, button {
        width: 100%;
        margin: 8px 0;
        padding: 10px;
        border-radius: 8px;
        border: 1px solid #ccc;
    }

    button {
        background-color: #4CAF50;
        color: white;
        border: none;
        cursor: pointer;
        transition: background 0.3s ease;
    }

    button:hover {
        background-color: #45a049;
    }

    .tiny-button {
        font-size: 10px;
        padding: 4px 8px;
        background-color: #e74c3c;
        color: white;
        border-radius: 6px;
        position: fixed;
        bottom: 20px;
        right: 20px;
        opacity: 0.7;
    }

    .tiny-button:hover {
        opacity: 1;
    }

    table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
    }

    table th, table td {
        padding: 10px;
        text-align: center;
        border-bottom: 1px solid #ddd;
    }

    table th {
        background-color: #f7fafc;
        color: #555;
    }

    tr:hover {
        background-color: #f1f1f1;
    }

    .checkbox-presenca input {
        transform: scale(1.3);
    }

    #nomeAluno, #dataChamada {
        width: calc(100% - 20px);
    }

    .add-btn {
        width: auto;
        padding: 8px 12px;
        background-color: #3498db;
        color: white;
    }

    .add-btn:hover {
        background-color: #2980b9;
    }

    .action-buttons button {
        margin-top: 10px;
    }
  </style>

  
</head>
<body>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

  <div id="login" class="container">
    <h2>Login do Professor</h2>
    <input type="text" id="username" placeholder="Usuário">
    <input type="password" id="password" placeholder="Senha">
    <button onclick="login()">Entrar</button>
</div>

<div id="selection" class="container" style="display:none;">
    <h2>Selecionar Escola e Turma</h2>
    <select id="escola" onchange="loadTurmas()">
        <option value="">Selecione a escola</option>
        <option value="CMEI Padre Luís Ruas">CMEI Padre Luís Ruas</option>
        <option value="Escola Municipal Nova Vida">Escola Municipal Nova Vida</option>
        <option value="Escola Municipal Liberalina Weill">Escola Municipal Liberalina Weill</option>
        <option value="Escola Estadual Santo Antônio">Escola Estadual Santo Antônio</option>
        <option value="Adolescentes - Vila da Felicidade">Adolescentes - Vila da Felicidade</option>
        <option value="Crianças - Vila da Felicidade">Crianças - Vila da Felicidade</option>
    </select>

    <select id="turma">
        <option value="">Selecione a turma</option>
    </select>

    <button onclick="abrirChamada()">Abrir Chamada</button>
</div>

<div id="chamada" class="container" style="display:none;">
    <h2>Chamada - <span id="escolaSelecionada"></span> / <span id="turmaSelecionada"></span></h2>

    <label>Data:</label>
    <input type="date" id="dataChamada">

    <label>Nome do Aluno:</label>
    <input type="text" id="nomeAluno" placeholder="Digite o nome">
    <button class="add-btn" onclick="adicionarAlunoDireto()">Adicionar</button>

    <table>
        <thead>
            <tr>
                <th>Nome</th>
                <th>Presente</th>
                <th>Falta</th>
                <th>Ausente Justificado</th>
            </tr>
        </thead>
        <tbody id="tabelaAlunos"></tbody>
    </table>

    <div class="action-buttons">
        <button onclick="exportarExcel()">Exportar para Excel</button>
        <button onclick="voltarParaSelecao()">Voltar</button>
    </div>

    <button id="remove-btn" class="tiny-button" onclick="removerAluno()">✖ Remover</button>
</div>

  <script>
    const professores = {
        "Izys": "iacas1234",
        "Nayara": "nayara",
        "Karina": "8770220",
        "prof4": "senha4",
        "prof5": "senha5",
        "prof6": "senha6",
        "prof7": "senha7",
        "prof8": "senha8",
        "prof9": "senha9",
        "prof10": "senha10"
    };

    const turmasPorEscola = {
        "CMEI Padre Luís Ruas": ["Turma 1"],
        "Escola Municipal Nova Vida": ["Turma 1"],
        "Escola Municipal Liberalina Weill": ["Matutino"],
        "Escola Estadual Santo Antônio": ["Matutino"],
        "Adolescentes - Vila da Felicidade": ["Matutino", "Vespertino"],
        "Crianças - Vila da Felicidade": ["Turma 3", "Turma 4"]
    };

    let alunos = [];
    let escolaAtual = "";
    let turmaAtual = "";

    function login() {
        const user = document.getElementById('username').value;
        const pass = document.getElementById('password').value;
        if (professores[user] && professores[user] === pass) {
            document.getElementById('login').style.display = 'none';
            document.getElementById('selection').style.display = 'block';
        } else {
            alert("Login inválido!");
        }
    }

    function loadTurmas() {
        const escola = document.getElementById('escola').value;
        const turmaSelect = document.getElementById('turma');
        turmaSelect.innerHTML = '<option value="">Selecione a turma</option>';
        if (turmasPorEscola[escola]) {
            turmasPorEscola[escola].forEach(turma => {
                const opt = document.createElement('option');
                opt.value = turma;
                opt.innerText = turma;
                turmaSelect.appendChild(opt);
            });
        }
    }

    function abrirChamada() {
        escolaAtual = document.getElementById('escola').value;
        turmaAtual = document.getElementById('turma').value;
        if (!escolaAtual || !turmaAtual) {
            alert("Selecione escola e turma!");
            return;
        }
        document.getElementById('selection').style.display = 'none';
        document.getElementById('chamada').style.display = 'block';
        document.getElementById('escolaSelecionada').innerText = escolaAtual;
        document.getElementById('turmaSelecionada').innerText = turmaAtual;

        carregarDoStorage();
        renderTabela();
    }

    function adicionarAlunoDireto() {
        const nome = document.getElementById('nomeAluno').value.trim();
        if (nome) {
            alunos.push({ nome, presente: false, falta: false, ausente: false });
            document.getElementById('nomeAluno').value = "";
            salvarNoStorage();
            renderTabela();
        } else {
            alert("Digite o nome do aluno!");
        }
    }

    function removerAluno() {
        const nome = prompt("Digite o nome exato do aluno a remover:");
        const inicial = alunos.length;
        alunos = alunos.filter(aluno => aluno.nome !== nome);
        if (alunos.length === inicial) {
            alert("Aluno não encontrado!");
        }
        salvarNoStorage();
        renderTabela();
    }

    function renderTabela() {
        const tbody = document.getElementById('tabelaAlunos');
        tbody.innerHTML = '';
        alunos.forEach((aluno, index) => {
            tbody.innerHTML += `
                <tr>
                    <td>${aluno.nome}</td>
                    <td><input type="checkbox" onchange="marcar(${index}, 'presente')" ${aluno.presente ? 'checked' : ''}></td>
                    <td><input type="checkbox" onchange="marcar(${index}, 'falta')" ${aluno.falta ? 'checked' : ''}></td>
                    <td><input type="checkbox" onchange="marcar(${index}, 'ausente')" ${aluno.ausente ? 'checked' : ''}></td>
                </tr>`;
        });
    }

    function marcar(index, tipo) {
        alunos[index].presente = false;
        alunos[index].falta = false;
        alunos[index].ausente = false;
        alunos[index][tipo] = true;
        salvarNoStorage();
        renderTabela();
    }

    function exportarExcel() {
        const data = document.getElementById('dataChamada').value;
        if (!data) {
            alert("Escolha uma data antes de exportar.");
            return;
        }
        if (alunos.length === 0) {
            alert("Nenhum aluno adicionado!");
            return;
        }

        const ws_data = [
            ["Escola", escolaAtual],
            ["Turma", turmaAtual],
            ["Data", data],
            [],
            ["Nome", "Presente", "Falta", "Ausente Justificado"]
        ];

        alunos.forEach(aluno => {
            ws_data.push([
                aluno.nome,
                aluno.presente ? "✔️" : "",
                aluno.falta ? "✔️" : "",
                aluno.ausente ? "✔️" : ""
            ]);
        });

        const wb = XLSX.utils.book_new();
        const ws = XLSX.utils.aoa_to_sheet(ws_data);
        XLSX.utils.book_append_sheet(wb, ws, "Chamada");
        XLSX.writeFile(wb, `Chamada_${escolaAtual}_${turmaAtual}_${data}.xlsx`);
    }

    function voltarParaSelecao() {
        salvarNoStorage();
        document.getElementById('chamada').style.display = 'none';
        document.getElementById('selection').style.display = 'block';
    }

    function salvarNoStorage() {
        const chave = `${escolaAtual}_${turmaAtual}`;
        localStorage.setItem(chave, JSON.stringify(alunos));
    }

    function carregarDoStorage() {
        const chave = `${escolaAtual}_${turmaAtual}`;
        const dados = localStorage.getItem(chave);
        if (dados) {
            alunos = JSON.parse(dados);
        } else {
            alunos = [];
        }
    }
  </script>
</body>
</html>
